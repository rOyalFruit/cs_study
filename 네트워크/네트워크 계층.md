## 계층 구조

### 계층 구조란?

> 통신이 이루어지는 과정을 단계별로 나누어 데이터의 흐름을 한눈에 파악할 수 있도록 한 구조 <br>
> 이를 통해 통신 중 문제가 발생했을 때, 전체 시스템을 건드리지 않고 문제가 생긴 계층에서만 원인을 분석하고 해결할 수 있음

---

### OSI 7계층

> `OSI 7계층`은 ISO(국제 표준화 기구)에서 개발한 네트워크 표준 모델로, 네트워크가 프로토콜을 통해 통신하는 과정을 7단계로 나누어 계층 간 상호 작용하는 방식을 정해놓은 것 <br> `OSI 7계층` 혹은 `OSI 참조 모델`이라고 불림

#### 애플리케이션 계층 (7계층)

> `애플리케이션 계층` 혹은 `응용 계층`이라 불리며, 최상위 계층으로써 사용자들이 사용하는 애플리케이션 목적에 맞는 통신 방법을 제공하는 계층 <br> 사용자가 응용 프로그램을 통해 네트워크 서비스에 접근할 수 있도록 사용자 인터페이스를 제공함

애플리케이션 계층에서 사용되는 프로토콜

1. HTTP(HyperText Transfer Protocol) : 월드 와이드 웹의 토대로, 하이퍼텍스트 링크를 사용하여 웹 페이지를 로드 하는데 사용 <br> 포트번호는 80
2. FTP(File Transfer Protocol) : 파일을 전송하는 기본 프로토콜 <br> 데이터 전송 시 20 포트, 제어정보 전달 시 21 포트 사용
3. SMTP(Simple Message Transfer Protocol) : 이메일을 보내기 위해 사용되는 프로토콜 <br> 포트번호는 25
4. DNS(Domain Name Service)

#### 프레젠테이션 계층 (6계층)

> `프레젠테이션 계층` 혹은 `표현 계층`이라 불리며, 애플리케이션 간의 통신에서 데이터 표현의 차이를 해결하기 위해 서로 다른 형식으로 변환해주거나 공통 형식을 제공하는 등 데이터의 표현 방식을 결정해주는 계층

프로젠테이션 계층에서 사용되는 프로토콜

1. JPEG
2. MPEG

#### 세션 계층 (5계층)

> `세션 계층`은 애플리케이션 간의 통신에서 세션을 관리하며 포트를 기반으로 통신을 연결해주는 계층 <br> 네트워크 장치간의 통신 방식을 결정할 수 있으며, 세션을 연결하고 해제하며 전송 중단시 동기화 기능을 통해 데이터를 복구할 수 있음

세션 계층에서 사용되는 프로토콜

1. SSH
2. TLS

#### 전송 계층 (4계층)

> `전송 계층`은 데이터 전송을 담당하는 계층 <br> 포트 번호를 기반으로 송신자와 수신자 간의 신뢰성있고 효율적인 데이터를 전송하기 위해 흐름제어, 오류제어 등의 기능을 제공

전송 계층에서 사용되는 프로토콜

##### 1. TCP

> TCP(Transmission Control Protocol)는 인터넷 상에서 데이터를 메세지 형태로 보내기 위해 IP와 함께 사용하는 프로토콜 <br> 패킷 사이의 순서를 보장하고 연결지향 프로토콜을 사용해서 연결을 하여 신뢰성을 구축해서 수신 여부를 확인 <br> `가상회선 패킷 교환 방식`을 사용

###### 가상회선 패킷 교환 방식

> 각 패킷에 가상회선 식별자가 포함되며 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착하는 방식 <br> ![가상회선 패킷 교환 방식](https://github.com/user-attachments/assets/98dd9799-1011-4710-962b-194f1a99bb31)

>
> > TCP 연결 성립 과정 (3-way handshake) <br> ![웨이 핸드셰이크](https://github.com/user-attachments/assets/02a171da-6e04-4213-9f9b-5539f1bda539) <br>
> >
> > 1.  `SYN` : 클라이언트가 서버에 클라이언트의 ISN을 담아 SYN을 보냄
> >     - ISN: 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 번호, 장치마다 값이 다를 수 있음
> > 2.  `SYN + ACK` : 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인번호로 클라이언트의 ISN + 1을 보냄
> > 3.  `ACK` : 클라이언트는 서버의 ISN + 1한 값인 승인번호를 담아 ACK를 서버에 보냄
>
> > TCP 연결 해제 과정 (4-way handshake) <br> ![tcp 연결 해제 과정](https://github.com/user-attachments/assets/62b1632d-541f-41cd-a072-b2a644f31627) <br>
> >
> > 1. 클라이언트가 연결을 종료하려고 할 때 `FIN`으로 설정된 세그먼트를 보내고, `FIN_WAIT_1` 상태로 들어가서 서버의 응답 기다림
> > 2. 서버는 클라이언트로 ACK 승인 세그먼트를 보내고, `CLOST_WAIT` 상태로 들어감. 클라이언트가 세그먼트를 받으면 `FIN_WAIT_2` 상태로 들어감
> > 3. 서버는 `ACK`를 보내고 일정 시간 이후에 클라이언트에 `FIN`이라는 세그먼트를 보냄
> > 4. 클라이언트는 `TIME_WAIT` 상태가 되고 다시 서버로 `ACK`를 보내서 서버는 `CLOSED` 상태가 됨. 이후에 클라이언트는 어느 정도의 시간을 대기한 후 연결이 닫히고 클라이언트와 서버의 모든 자원의 연결이 해제됨

##### 2. UDP

> UDP(User Datagram Protocol)는 데이터를 데이터그램 단위로 처리하는 프로토콜 <br> 순서를 보장하지 않고 수신 여부를 확인하지 않으며 단순히 데이터만 주는 `데이터그램 패킷 교환 방식`을 사용

###### 데이터그램 패킷 교환 방식

> 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 이동 <br> 하나의 메세지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있으며 도착한 순서가 다를 수 있는 방식 <br> ![데이터그램 패킷 교환 방식](https://github.com/user-attachments/assets/1e7e3a8c-82a2-4dac-9a44-43e9960445d9)

#### 네트워크 계층 (3계층)

> `네트워크 계층`은 실제 네트워크 간의 라우팅을 담당하는 계층 <br> IP 주소등을 통해 데이터를 목적지까지 안전하고 빠르게 전달하는 역할 <br> 라우터를 통해 경로를 선택하여 경로에 따라 패킷을 전달 <br> 상대방이 제대로 전달 받았는지에 대해서는 보장하지 않는 비연결형적인 특성을 가짐

네트워크 계층에서 사용되는 프로토콜

1. IP
2. ARP

#### 데이터 링크 계층 (2계층)

> `데이터 링크 계층`은 장비의 고유 주소인 MAC 주소를 이용하여 노드 간 데이터를 전송하는 계층 <br> IP 주소를 가지고 MAC 주소를 찾거나, MAC 주소를 가지고 IP 주소를 찾아줌

데이터 링크 계층에서 사용되는 프로토콜

1. ARP(Address Resolution Protocol) : IP 주소를 이용해 상대방의 MAC 주소를 알아오는 프로토콜
2. RARP(Reverse Address Resolution Protocol) : MAC 주소에 해당하는 IP 주소를 알아오는 프로토콜

#### 물리 계층 (1계층)

> `물리 계층`은 하드웨어같은 물리적인 매체를 통해 비트 단위로 데이터를 전송하는 계층 <br> 데이터 링크 계층으로부터 프레임을 받아 0과 1로 이루어진 전기 신호로 데이터를 변환하여 구리나 광섬유, 무선 통신 매체를 통해 전송 <br> `물리 계층`은 단순히 데이터 전달의 역할만을 수행

---

### TCP/IP 4계층

> `TCP/IP 4계층`은 실제 인터넷 통신 시 기반이 되는 모델로, OSI 7계층이 개념적인 성향의 모델인 것과 상반되는 모델

#### 애플리케이션 계층 (4계층)

> OSI 7계층에서의 5, 6, 7계층에 해당함

#### 전송 계층 (3계층)

> OSI 7계층에서의 4계층에 해당함

#### 인터넷 계층 (2계층)

> OSI 7계층에서의 3계층(네트워크 계층)에 해당함

#### 링크 계층 (1계층)

> OSI 7계층에서의 1, 2계층에 해당함 <br> 해당 계층을 2개로 분리하여 5계층으로 구분하기도 함

---

## PDU

> 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위를 PDU (Protocol Data Unit) 이라 함
